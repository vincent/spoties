spoti.es {

    encode gzip zstd

    @static {
        file
        path *.ico *.css *.js *.gif *.webp *.avif *.jpg *.jpeg *.png *.svg *.woff *.woff2
    }
    header @static Cache-Control max-age=5184000

    tls {
        dns cloudflare TOKEN
        resolvers 1.1.1.1
    }

    route /api/* {
        reverse_proxy 127.0.0.1:8090
    }

    route /_app/* {
        root * /srv/spoties/current/frontend
        try_files {path} {path}/ /index.html
        file_server
    }

    route /_* {
        reverse_proxy 127.0.0.1:8090
    }

    route /* {
        root * /srv/spoties/current/frontend
        try_files {path} {path}/ /index.html
        file_server
    }
}